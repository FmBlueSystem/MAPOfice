# Prompt 02.2: HAMMS Dimension Calculations

## Context
- HAMMSAnalyzer base class exists
- Adding dimension calculation methods

## Execute

### Add dimension methods to HAMMSAnalyzer
```python
# Create src/analysis/hamms_dimensions.py
cat > src/analysis/hamms_dimensions.py << 'EOF'
"""HAMMS Dimension Calculators"""
import numpy as np

def calculate_danceability(bpm, energy):
    """Calculate danceability (0-1)"""
    optimal_bpm = (bpm >= 120 and bpm <= 128)
    base = 0.5
    if optimal_bpm:
        base = 0.8
    return np.clip(base + energy * 0.2, 0, 1)

def calculate_valence(key, energy):
    """Calculate musical positivity"""
    major = 'B' in key  # Simple: B=major
    base = 0.7 if major else 0.3
    return np.clip(base + energy * 0.3, 0, 1)

def calculate_acousticness(genre=''):
    """Estimate acoustic vs electronic"""
    electronic = ['house', 'techno', 'edm']
    if genre.lower() in electronic:
        return 0.2
    return 0.7

def calculate_rhythmic(bpm):
    """Calculate rhythmic complexity"""
    if bpm < 100:
        return 0.3
    elif bpm < 140:
        return 0.6
    return 0.8
EOF
```

### Update base class
```python
# Append to src/analysis/hamms_base.py
cat >> src/analysis/hamms_base.py << 'EOF'

from . import hamms_dimensions as dims

def calculate_vector(self, track_data):
    """Calculate 12-D vector"""
    v = self.create_vector()
    
    # Basic dimensions
    v[0] = self.normalize_bpm(track_data.get('bpm', 120))
    v[2] = track_data.get('energy', 0.5)
    
    # Calculated dimensions
    v[3] = dims.calculate_danceability(
        track_data.get('bpm', 120),
        track_data.get('energy', 0.5)
    )
    v[4] = dims.calculate_valence(
        track_data.get('key', 'Am'),
        track_data.get('energy', 0.5)
    )
    
    return v

HAMMSAnalyzer.calculate_vector = calculate_vector
EOF
```

## Test
```python
# Test calculation
python -c "
from src.analysis.hamms_base import HAMMSAnalyzer
h = HAMMSAnalyzer()
v = h.calculate_vector({'bpm': 128, 'energy': 0.8})
print(f'Vector: {v[:5]}')
print('✓ Dimensions working')
"
```

## Checkpoint
```json
{
  "prompt": "02.2-hamms-dimensions",
  "success": true,
  "methods_added": 4
}
```

## Next
→ Continue to `02.3-hamms-validation.md`

---
*Tokens: ~2500 | Time: 5 min | Checkpoint: Required*